{% extends 'base.html' %}

{% block title %}{{ product.name }} - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <!-- Product Header -->
    <div style="text-align: center; margin-bottom: 2rem; padding: 2rem; background: rgba(0, 0, 0, 0.6); border: 2px solid #00ff41; border-radius: 10px;">
        <h2>{{ product.name }}</h2>
        <p style="color: #ffd700; font-size: 1.5rem; font-weight: bold; margin: 1rem 0;">
            💰 {{ product.price_btc }} BTC
        </p>
        <p style="color: #666;">({{ product.get_price_sats }} satoshis)</p>
    </div>

    <!-- Product Content -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <!-- Product Image -->
        <div style="background: rgba(0, 0, 0, 0.6); border: 2px solid #00ff41; border-radius: 10px; padding: 1rem; display: flex; align-items: center; justify-content: center; min-height: 300px;">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                 style="max-width: 100%; max-height: 280px; border-radius: 5px;">
            {% else %}
            <div style="text-align: center; color: #666;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">🖼️</div>
                <p>No Image Available</p>
            </div>
            {% endif %}
        </div>

        <!-- Product Info -->
        <div style="background: rgba(0, 0, 0, 0.6); border: 2px solid #00ff41; border-radius: 10px; padding: 1.5rem;">
            <h3>Description</h3>
            <p style="color: #ccc; line-height: 1.6; margin-bottom: 2rem;">{{ product.description }}</p>

            <!-- Buy Button -->
            <button onclick="createOrder({{ product.id }})" 
                    style="width: 100%; background: linear-gradient(135deg, #00ff41, #00cc33); color: #000; padding: 1rem; border: none; border-radius: 5px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-bottom: 1rem;">
                🛒 Buy Now
            </button>

            <!-- Features -->
            <div style="margin-top: 2rem;">
                <h4>📦 Product Features</h4>
                <ul style="color: #ccc; list-style: none; padding: 0;">
                    <li style="padding: 0.5rem 0; border-bottom: 1px solid #333;">⚡ Instant digital delivery</li>
                    <li style="padding: 0.5rem 0; border-bottom: 1px solid #333;">🛡️ 100% anonymous transaction</li>
                    <li style="padding: 0.5rem 0; border-bottom: 1px solid #333;">₿ Bitcoin payment only</li>
                    <li style="padding: 0.5rem 0;">🔒 Encrypted communication</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Order Form (will be shown via JavaScript) -->
    <div id="order-section" style="display: none; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff41; border-radius: 10px; padding: 2rem; margin-top: 2rem;">
        <h3>₿ Complete Your Purchase</h3>
        <div id="order-details"></div>
    </div>
</div>

<script>
function createOrder(productId) {
    // Show loading state
    const buyButton = document.querySelector('button');
    buyButton.innerHTML = '🔄 Processing...';
    buyButton.disabled = true;

    // Create order via API
    fetch('/store/api/create-order/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ product_id: productId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show order details
            document.getElementById('order-details').innerHTML = `
                <p>Please send <strong>${data.amount_btc} BTC</strong> to:</p>
                <p style="font-family: monospace; background: rgba(0, 255, 65, 0.1); padding: 1rem; border-radius: 5px; word-break: break-all;">
                    ${data.bitcoin_address}
                </p>
                <p>Order ID: <code>${data.order_id}</code></p>
                <p>Expires at: ${new Date(data.expires_at).toLocaleString()}</p>
                
                <div style="margin-top: 1rem;">
                    <a href="/store/order/${data.order_id}/" 
                       style="background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; padding: 0.8rem 1.5rem; text-decoration: none; border-radius: 5px; font-weight: bold;">
                        📋 View Order Details
                    </a>
                </div>
            `;
            
            document.getElementById('order-section').style.display = 'block';
            
            // Scroll to order section
            document.getElementById('order-section').scrollIntoView({ behavior: 'smooth' });
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Error creating order: ' + error);
    })
    .finally(() => {
        // Reset button
        buyButton.innerHTML = '🛒 Buy Now';
        buyButton.disabled = false;
    });
}
</script>
{% endblock %}
